# ~/android/robotforest-wow64-runtime/.github/workflows/smoke-runtime.yml
name: Smoke Runtime

on:
  workflow_dispatch:
    inputs:
      tag:
        description: Run smoke verify for this tag (empty = current ref)
        required: false
        default: ""
        type: string

permissions:
  contents: read

jobs:
  build:
    uses: ./.github/workflows/release-core.yml
    with:
      tag: ${{ inputs.tag }}

  verify:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: rf-runtime-dist
          path: out
      - name: Find runtime zip
        id: z
        run: |
          set -euo pipefail
          f="$(ls -1 out/**/robotforest-wow64-runtime-*.zip | head -n1)"
          echo "zip=$f" >> "$GITHUB_OUTPUT"
      - name: Unzip
        run: |
          set -euo pipefail
          mkdir -p run
          unzip -q "${{ steps.z.outputs.zip }}" -d run
      - name: Verify
        run: |
          set -euo pipefail
          RDIR="$(find run -maxdepth 1 -type d -name 'robotforest-wow64-runtime-*' | head -n1)"
          bash "$RDIR/scripts/rf_verify_runtime.sh"
