name: RF Quick

on:
  push:
    branches: ["ci/**"]
  pull_request:
    branches: ["main", "ci/**"]

permissions:
  contents: read

concurrency:
  group: rf-quick-${{ github.ref }}
  cancel-in-progress: true

jobs:
  quick:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Verify pins + list tree snapshot
        run: |
          set -euxo pipefail
          bash scripts/ci/fetch_components.sh --verify-only
          echo "=== GIT TREE (TOP 200) ==="
          git ls-files | head -n 200

      - name: Shellcheck (scripts)
        run: |
          set -euxo pipefail
          sudo apt-get update
          sudo apt-get install -y shellcheck
          # Shellcheck all our sh files; ignore vendor dirs if any
          mapfile -t SHS < <(git ls-files | grep -E '\.(sh|bash)$' || true)
          if [ "${#SHS[@]}" -gt 0 ]; then
            shellcheck "${SHS[@]}"
          else
            echo "No shell scripts to check."
          fi
